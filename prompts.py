def generate_summary():
    prompt = f"""
Î•Î½ÏƒÎ±ÏÎºÏŽÎ½ÎµÎ¹Ï‚ Ï„Î¿Î½ ÏÏŒÎ»Î¿ ÎµÎ½ÏŒÏ‚ Î­Î¼Ï€ÎµÎ¹ÏÎ¿Ï… ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯Î± Î´Î·Î¼Î¿ÏƒÎ¹Î¿Î³ÏÎ¬Ï†Î¿Ï…. Î£ÎºÎ¿Ï€ÏŒÏ‚ ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ Î½Î± ÏƒÏ…Î½Ï„Î¬Î¾ÎµÎ¹Ï‚ ÏƒÏ…Î½Î¿Ï€Ï„Î¹ÎºÎ®, Ï€Î»Î®ÏÎ· ÎºÎ±Î¹ Î±ÎºÏÎ¹Î²Î® Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· Ï„Î¿Ï… Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ»Î»Î·Î½Î¹ÎºÎ¿Ï Î¬ÏÎ¸ÏÎ¿Ï…, ÏƒÎµ Î¼Î¿ÏÏ†Î® bullets.
 
ÎŸÎ´Î·Î³Î¯ÎµÏ‚:
- Î”Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ Î­Ï‰Ï‚ 4 bullets, Î¼Îµ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏŒ Î¼Î®ÎºÎ¿Ï‚ 50â€“100 Î»Î­Î¾ÎµÎ¹Ï‚.
- ÎšÎ¬Î¸Îµ bullet Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÎ¹ Î­Î½Î± Î²Î±ÏƒÎ¹ÎºÏŒ Î³ÎµÎ³Î¿Î½ÏŒÏ‚, ÎµÏ€Î¹Ï‡ÎµÎ¯ÏÎ·Î¼Î± Î® ÏƒÎ·Î¼ÎµÎ¯Î¿ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï….
- Î‘Ï€ÏŒÏ†Ï…Î³Îµ Î³ÎµÎ½Î¹ÎºÏŒÏ„Î·Ï„ÎµÏ‚ ÎºÎ±Î¹ Î±ÏŒÏÎ¹ÏƒÏ„ÎµÏ‚ Î´Î¹Î±Ï„Ï…Ï€ÏŽÏƒÎµÎ¹Ï‚.
- ÎœÎ·Î½ Î¾ÎµÎºÎ¹Î½Î¬Ï‚ Ï„Î± bullets Î¼Îµ Î¬ÏÎ¸ÏÎ± (Ï€.Ï‡. Â«Î—Â», Â«ÎŸÂ», Â«Î¤Î¿Â»).
- Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎµ Î¿Ï…Î´Î­Ï„ÎµÏÎ¿ ÎºÎ±Î¹ ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ ÏÏ†Î¿Ï‚, ÏŒÏ€Ï‰Ï‚ Î±Ï…Ï„ÏŒ Ï„Î¿Ï… Î±ÏÏ‡Î¹ÎºÎ¿Ï Î¬ÏÎ¸ÏÎ¿Ï….
- Î— Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î²Î±ÏƒÎ¯Î¶ÎµÏ„Î±Î¹ Î±Ï…ÏƒÏ„Î·ÏÎ¬ ÏƒÏ„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï…, Ï‡Ï‰ÏÎ¯Ï‚ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎµÏ‚ Î® ÎµÎ¹ÎºÎ±ÏƒÎ¯ÎµÏ‚.
-Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: ÎŸÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î»Î­Î¾ÎµÎ¹Ï‚ Î® Ï†ÏÎ¬ÏƒÎµÎ¹Ï‚ ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ Î±Î½Î¬Î¼ÎµÏƒÎ± ÏƒÎµ Î´Î¹Ï€Î»Î¿ÏÏ‚ Î±ÏƒÏ„ÎµÏÎ¯ÏƒÎºÎ¿Ï…Ï‚ (Ï€.Ï‡. **Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±**). Î‘Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ ÏƒÏ„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î¬ÏÎ¸ÏÎ¿ Î®Ï„Î±Î½ Î³ÏÎ±Î¼Î¼Î­Î½ÎµÏ‚ Î¼Îµ Î­Î½Ï„Î¿Î½Î· Î³ÏÎ±Ï†Î® (bold) ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ­Ï‚ Î³Î¹Î± Ï„Î·Î½ Ï€ÎµÏÎ¹Î»Î·ÏˆÎ·.:
 
{state["article_text"]}
"""
Î•Î½ÏƒÎ±ÏÎºÏŽÎ½ÎµÎ¹Ï‚ Ï„Î¿Î½ ÏÏŒÎ»Î¿ ÎµÎ½ÏŒÏ‚ Î­Î¼Ï€ÎµÎ¹ÏÎ¿Ï… ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯Î± Î´Î·Î¼Î¿ÏƒÎ¹Î¿Î³ÏÎ¬Ï†Î¿Ï…. Î£ÎºÎ¿Ï€ÏŒÏ‚ ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ Î½Î± ÏƒÏ…Î½Ï„Î¬Î¾ÎµÎ¹Ï‚ ÏƒÏ…Î½Î¿Ï€Ï„Î¹ÎºÎ®, Ï€Î»Î®ÏÎ· ÎºÎ±Î¹ Î±ÎºÏÎ¹Î²Î® ÎµÎ¾Î±Î³Ï‰Î³Î® Ï„Ï‰Î½ ÎºÏÏÎ¹Ï‰Î½ Î¹Î´ÎµÏŽÎ½/ÏƒÎ·Î¼ÎµÎ¯Ï‰Î½ Ï„Î¿Ï… Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ»Î»Î·Î½Î¹ÎºÎ¿Ï Î¬ÏÎ¸ÏÎ¿Ï…, ÏƒÎµ Î¼Î¿ÏÏ†Î® bullets.
 
ÎŸÎ´Î·Î³Î¯ÎµÏ‚:
- Î”Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ 3-4 bullets.
- ÎšÎ±Î¸Îµ bullet Î½Î± Î­Ï‡ÎµÎ¹ Î¼Î­Î³Î¹ÏƒÏ„Î¿ Î±ÏÎ¹Î¸Î¼ÏŒ Î»Î­Î¾ÎµÏ‰Î½ 45.
- ÎšÎ¬Î¸Îµ bullet Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÎ¹ Î­Î½Î± Î²Î±ÏƒÎ¹ÎºÏŒ Î³ÎµÎ³Î¿Î½ÏŒÏ‚, ÎµÏ€Î¹Ï‡ÎµÎ¯ÏÎ·Î¼Î± Î® ÏƒÎ·Î¼ÎµÎ¯Î¿ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï….
- Î‘Ï€ÏŒÏ†Ï…Î³Îµ Î³ÎµÎ½Î¹ÎºÏŒÏ„Î·Ï„ÎµÏ‚ ÎºÎ±Î¹ Î±ÏŒÏÎ¹ÏƒÏ„ÎµÏ‚ Î´Î¹Î±Ï„Ï…Ï€ÏŽÏƒÎµÎ¹Ï‚.
- ÎœÎ·Î½ Î¾ÎµÎºÎ¹Î½Î¬Ï‚ Ï„Î± bullets Î¼Îµ Î¬ÏÎ¸ÏÎ± (Ï€.Ï‡. Â«Î—Â», Â«ÎŸÂ», Â«Î¤Î¿Â»).
- Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎµ Î¿Ï…Î´Î­Ï„ÎµÏÎ¿ ÎºÎ±Î¹ ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ ÏÏ†Î¿Ï‚, ÏŒÏ€Ï‰Ï‚ Î±Ï…Ï„ÏŒ Ï„Î¿Ï… Î±ÏÏ‡Î¹ÎºÎ¿Ï Î¬ÏÎ¸ÏÎ¿Ï….
- Î¤Î± bullets Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î²Î±ÏƒÎ¯Î¶Î¿Î½Ï„Î±Î¹ Î±Ï…ÏƒÏ„Î·ÏÎ¬ ÏƒÏ„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï…, Ï‡Ï‰ÏÎ¯Ï‚ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎµÏ‚ Î® ÎµÎ¹ÎºÎ±ÏƒÎ¯ÎµÏ‚.
-Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: ÎŸÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î»Î­Î¾ÎµÎ¹Ï‚ Î® Ï†ÏÎ¬ÏƒÎµÎ¹Ï‚ ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ Î±Î½Î¬Î¼ÎµÏƒÎ± ÏƒÎµ Î´Î¹Ï€Î»Î¿ÏÏ‚ Î±ÏƒÏ„ÎµÏÎ¯ÏƒÎºÎ¿Ï…Ï‚ (Ï€.Ï‡. **Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±**). Î‘Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ ÏƒÏ„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î¬ÏÎ¸ÏÎ¿ Î®Ï„Î±Î½ Î³ÏÎ±Î¼Î¼Î­Î½ÎµÏ‚ Î¼Îµ Î­Î½Ï„Î¿Î½Î· Î³ÏÎ±Ï†Î® (bold) ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ­Ï‚ Î³Î¹Î± Ï„Î·Î½ ÎµÎ¾Î±Î³Ï‰Î³Î® Ï„Ï‰Î½ bullets.:
 
{state["article_text"]}



from langchain_core.messages import HumanMessage
from summary_state import State
import os
import config            
from langchain_core.messages import HumanMessage
from summary_state import State

def format_article_text(state: State) -> dict:
    a = state["article"]
    print(a)
    full_text = f"""
Î¤Î¯Ï„Î»Î¿Ï‚: {a.get("title", "")}
Î¥Ï€ÏŒÏ„Î¹Ï„Î»Î¿Ï‚: {a.get("subtitle", "")}

ÎšÎµÎ¯Î¼ÎµÎ½Î¿:
{a.get("body", "")}


"""
    return {"article_text": full_text.strip()}

#Î›Î­Î¾ÎµÎ¹Ï‚-ÎºÎ»ÎµÎ¹Î´Î¹Î¬: {a.get("keywords", "")}



def explain_terms(state: State) -> dict:
    prompt = f"""
Î•Î½ÎµÏÎ³ÎµÎ¯Ï‚ Ï‰Ï‚ ÎµÎ¹Î´Î¹ÎºÏŒÏ‚ ÏƒÏ„Î· Î³Î»Ï‰ÏƒÏƒÎ¹ÎºÎ® Î±Ï€Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎ±Î¹ ÎºÎ±Ï„Î±Î½ÏŒÎ·ÏƒÎ· ÏŒÏÏ‰Î½ ÏƒÎµ Î´Î·Î¼ÏŒÏƒÎ¹Î± ÎºÎ±Î¹ Î´Î·Î¼Î¿ÏƒÎ¹Î¿Î³ÏÎ±Ï†Î¹ÎºÎ¬ ÎºÎµÎ¯Î¼ÎµÎ½Î±. ÎŸ ÏÏŒÎ»Î¿Ï‚ ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ Î½Î± ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ Î½Î± ÎµÏ€ÎµÎ¾Î·Î³Î®ÏƒÎµÎ¹Ï‚ Î´ÏÏƒÎºÎ¿Î»ÎµÏ‚, Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ Î® Î±ÏƒÏ…Î½Î®Î¸Î¹ÏƒÏ„ÎµÏ‚ Î»Î­Î¾ÎµÎ¹Ï‚ ÎºÎ±Î¹ Ï†ÏÎ¬ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï„Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ»Î»Î·Î½Î¹ÎºÏŒ Î¬ÏÎ¸ÏÎ¿, ÏŽÏƒÏ„Îµ Î½Î± Î³Î¯Î½ÎµÎ¹ Ï€Î¹Î¿ ÎºÎ±Ï„Î±Î½Î¿Î·Ï„ÏŒ ÏƒÎµ Î­Î½Î± ÎµÏ…ÏÏ, Î¼Î· ÎµÎ¾ÎµÎ¹Î´Î¹ÎºÎµÏ…Î¼Î­Î½Î¿ ÎºÎ¿Î¹Î½ÏŒ.
 
ÎŸÎ´Î·Î³Î¯ÎµÏ‚:
- Î•Î½Ï„ÏŒÏ€Î¹ÏƒÎµ Î»Î­Î¾ÎµÎ¹Ï‚ Î® Ï†ÏÎ¬ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Ï€Î¹Î¸Î±Î½ÏŒ Î½Î± **Î¼Î·Î½ ÎºÎ±Ï„Î±Î½Î¿Î¿ÏÎ½Ï„Î±Î¹ ÎµÏÎºÎ¿Î»Î±** Î±Ï€ÏŒ Ï„Î¿ Î³ÎµÎ½Î¹ÎºÏŒ ÎºÎ¿Î¹Î½ÏŒ. Î‘Ï…Ï„Î­Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹:
  - Î¤ÎµÏ‡Î½Î¹ÎºÎ¿Î¯, Î½Î¿Î¼Î¹ÎºÎ¿Î¯, Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ¿Î¯, Î´Î¹Î¿Î¹ÎºÎ·Ï„Î¹ÎºÎ¿Î¯ Î® Î¸ÎµÏƒÎ¼Î¹ÎºÎ¿Î¯ ÏŒÏÎ¿Î¹.
  - ÎŒÏÎ¿Î¹ Î¼Îµ ÎµÎ¹Î´Î¹ÎºÎ® ÏƒÎ·Î¼Î±ÏƒÎ¯Î± ÏƒÏ„Î¿ Ï€Î»Î±Î¯ÏƒÎ¹Î¿ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï….
  - ÎŒÏ‡Î¹ ÏƒÏ…Ï‡Î½Î¬ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼ÎµÎ½ÎµÏ‚ Î® Î»ÏŒÎ³Î¹ÎµÏ‚ Î»Î­Î¾ÎµÎ¹Ï‚.
- Î“Î¹Î± ÎºÎ¬Î¸Îµ Î»Î­Î¾Î· Î® Ï†ÏÎ¬ÏƒÎ·, Î´ÏŽÏƒÎµ **ÏƒÏÎ½Ï„Î¿Î¼Î· ÎµÏ€ÎµÎ¾Î®Î³Î·ÏƒÎ·** ÏƒÎµ Î±Ï€Î»Î®, ÏƒÎ±Ï†Î® Î³Î»ÏŽÏƒÏƒÎ± (1â€“2 Ï€ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚).
- Î‘Î½ ÏƒÏ„Î¿ Î¬ÏÎ¸ÏÎ¿ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î»Î­Î¾ÎµÎ¹Ï‚ Î® Ï†ÏÎ¬ÏƒÎµÎ¹Ï‚ Î¼Îµ **Î­Î½Ï„Î¿Î½Î· Î³ÏÎ±Ï†Î®**, ÎµÎ¾Î­Ï„Î±ÏƒÎ­ Ï„ÎµÏ‚ ÎºÎ±Ï„Î¬ Ï€ÏÎ¿Ï„ÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î±.
- ÎœÎ·Î½ ÎµÎ¾Î·Î³ÎµÎ¯Ï‚ Î»Î­Î¾ÎµÎ¹Ï‚ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Î±Ï…Ï„Î¿Î½ÏŒÎ·Ï„ÎµÏ‚ Î® ÎºÎ±Î¸Î·Î¼ÎµÏÎ¹Î½Î­Ï‚.
- **ÎœÎ·Î½ Ï€ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚** Ï€Î¿Ï… Î´ÎµÎ½ Ï€ÏÎ¿ÎºÏÏ€Ï„Î¿Ï…Î½ Î® Î´ÎµÎ½ Ï…Ï€Î¿Î½Î¿Î¿ÏÎ½Ï„Î±Î¹ Î¬Î¼ÎµÏƒÎ± Î±Ï€ÏŒ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿.
- Î‘Ï€ÏŒÏ†Ï…Î³Îµ Ï„Î¹Ï‚ ÎµÏ€Î±Î½Î±Î»Î®ÏˆÎµÎ¹Ï‚ ÏŒÏÏ‰Î½ Î® Ï€Î±ÏÏŒÎ¼Î¿Î¹Ï‰Î½ ÎµÏ€ÎµÎ¾Î·Î³Î®ÏƒÎµÏ‰Î½.

Î†ÏÎ¸ÏÎ¿:
{state["article_text"]}
"""
    res = config.llm.invoke([HumanMessage(content=prompt)])
    return {"explanations": res.content}


#-Î•Î¬Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï†ÏÎ¬ÏƒÎµÎ¹Ï‚ ÏƒÎµ **Î­Î½Ï„Î¿Î½Î· Î³ÏÎ±Ï†Î®**, Î´ÏŽÏƒÎµ Ï€ÏÎ¿Ï„ÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î± ÏƒÎµ Î±Ï…Ï„Î­Ï‚. prolast

def generate_summary(state: State) -> dict:
    prompt = f"""
Î•Î½ÏƒÎ±ÏÎºÏŽÎ½ÎµÎ¹Ï‚ Ï„Î¿Î½ ÏÏŒÎ»Î¿ ÎµÎ½ÏŒÏ‚ Î­Î¼Ï€ÎµÎ¹ÏÎ¿Ï… ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯Î± Î´Î·Î¼Î¿ÏƒÎ¹Î¿Î³ÏÎ¬Ï†Î¿Ï…. Î£ÎºÎ¿Ï€ÏŒÏ‚ ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ Î½Î± ÏƒÏ…Î½Ï„Î¬Î¾ÎµÎ¹Ï‚ ÏƒÏ…Î½Î¿Ï€Ï„Î¹ÎºÎ®, Ï€Î»Î®ÏÎ· ÎºÎ±Î¹ Î±ÎºÏÎ¹Î²Î® ÎµÎ¾Î±Î³Ï‰Î³Î® Ï„Ï‰Î½ ÎºÏÏÎ¹Ï‰Î½ Î¹Î´ÎµÏŽÎ½/ÏƒÎ·Î¼ÎµÎ¯Ï‰Î½ Ï„Î¿Ï… Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ»Î»Î·Î½Î¹ÎºÎ¿Ï Î¬ÏÎ¸ÏÎ¿Ï…, ÏƒÎµ Î¼Î¿ÏÏ†Î® bullets.
 
ÎŸÎ´Î·Î³Î¯ÎµÏ‚:
- Î”Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ 3-4 bullets.
- ÎšÎ±Î¸Îµ bullet Î½Î± Î­Ï‡ÎµÎ¹ Î¼Î­Î³Î¹ÏƒÏ„Î¿ Î±ÏÎ¹Î¸Î¼ÏŒ Î»Î­Î¾ÎµÏ‰Î½ 45.
- ÎšÎ¬Î¸Îµ bullet Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÎ¹ Î­Î½Î± Î²Î±ÏƒÎ¹ÎºÏŒ Î³ÎµÎ³Î¿Î½ÏŒÏ‚, ÎµÏ€Î¹Ï‡ÎµÎ¯ÏÎ·Î¼Î± Î® ÏƒÎ·Î¼ÎµÎ¯Î¿ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï….
- Î‘Ï€ÏŒÏ†Ï…Î³Îµ Î³ÎµÎ½Î¹ÎºÏŒÏ„Î·Ï„ÎµÏ‚ ÎºÎ±Î¹ Î±ÏŒÏÎ¹ÏƒÏ„ÎµÏ‚ Î´Î¹Î±Ï„Ï…Ï€ÏŽÏƒÎµÎ¹Ï‚.
- ÎœÎ·Î½ Î¾ÎµÎºÎ¹Î½Î¬Ï‚ Ï„Î± bullets Î¼Îµ Î¬ÏÎ¸ÏÎ± (Ï€.Ï‡. Â«Î—Â», Â«ÎŸÂ», Â«Î¤Î¿Â»).
- Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎµ Î¿Ï…Î´Î­Ï„ÎµÏÎ¿ ÎºÎ±Î¹ ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ ÏÏ†Î¿Ï‚, ÏŒÏ€Ï‰Ï‚ Î±Ï…Ï„ÏŒ Ï„Î¿Ï… Î±ÏÏ‡Î¹ÎºÎ¿Ï Î¬ÏÎ¸ÏÎ¿Ï….
- Î¤Î± bullets Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î²Î±ÏƒÎ¯Î¶Î¿Î½Ï„Î±Î¹ Î±Ï…ÏƒÏ„Î·ÏÎ¬ ÏƒÏ„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï…, Ï‡Ï‰ÏÎ¯Ï‚ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎµÏ‚ Î® ÎµÎ¹ÎºÎ±ÏƒÎ¯ÎµÏ‚.
-Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: ÎŸÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î»Î­Î¾ÎµÎ¹Ï‚ Î® Ï†ÏÎ¬ÏƒÎµÎ¹Ï‚ ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ Î±Î½Î¬Î¼ÎµÏƒÎ± ÏƒÎµ Î´Î¹Ï€Î»Î¿ÏÏ‚ Î±ÏƒÏ„ÎµÏÎ¯ÏƒÎºÎ¿Ï…Ï‚ (Ï€.Ï‡. **Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±**). Î‘Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ ÏƒÏ„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î¬ÏÎ¸ÏÎ¿ Î®Ï„Î±Î½ Î³ÏÎ±Î¼Î¼Î­Î½ÎµÏ‚ Î¼Îµ Î­Î½Ï„Î¿Î½Î· Î³ÏÎ±Ï†Î® (bold) ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ­Ï‚ Î³Î¹Î± Ï„Î·Î½ ÎµÎ¾Î±Î³Ï‰Î³Î® Ï„Ï‰Î½ bullets.:
 
{state["article_text"]}
"""

    res = config.llm.invoke([HumanMessage(content=prompt)])
    return {"summary": res.content,
    "summary_1": res.content}


def generate_questions(state: State) -> dict:
    prompt = f"""
Î•Î½ÏƒÎ±ÏÎºÏŽÎ½ÎµÎ¹Ï‚ Ï„Î¿Î½ ÏÏŒÎ»Î¿ ÎµÎ¹Î´Î¹ÎºÎ¿Ï ÏƒÏ„Î·Î½ ÎºÎ±Ï„Î±Î½ÏŒÎ·ÏƒÎ· ÎºÎ±Î¹ Î±Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ· ÎµÎ»Î»Î·Î½Î¹ÎºÏŽÎ½ ÎºÎµÎ¹Î¼Î­Î½Ï‰Î½. ÎŸ ÏƒÏ„ÏŒÏ‡Î¿Ï‚ ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹Ï‚ 5â€“7 ÎºÎ±Î»Î¿Î´Î¿Î¼Î·Î¼Î­Î½ÎµÏ‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î½Î± ÎµÎ»Î­Î³Ï‡Î¿Ï…Î½ ÎµÎ¹Ï‚ Î²Î¬Î¸Î¿Ï‚ Ï„Î·Î½ ÎºÎ±Ï„Î±Î½ÏŒÎ·ÏƒÎ· Ï„Î¿Ï… Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Î¬ÏÎ¸ÏÎ¿Ï….

ÎŸÎ´Î·Î³Î¯ÎµÏ‚:
- Î’Î±ÏƒÎ¯ÏƒÎ¿Ï… Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ ÏƒÏ„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï….
- Î•ÏƒÏ„Î¯Î±ÏƒÎµ ÏƒÎµ Î²Î±ÏƒÎ¹ÎºÎ­Ï‚ Î¹Î´Î­ÎµÏ‚, ÎµÏ€Î¹Ï‡ÎµÎ¹ÏÎ®Î¼Î±Ï„Î±, Î±Î¹Ï„Î¯ÎµÏ‚ ÎºÎ±Î¹ ÏƒÏ…Î½Î­Ï€ÎµÎ¹ÎµÏ‚.
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï€Î¿Î¹ÎºÎ¹Î»Î¯Î± ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¹ÎºÏŽÎ½ Ï„ÏÏ€Ï‰Î½ (Ï€.Ï‡. Î¤Î¹, Î“Î¹Î±Ï„Î¯, Î ÏŽÏ‚, Î Î¿Î¹Î¿Î¹, Î ÏŒÏ„Îµ).
- Î¦ÏÏŒÎ½Ï„Î¹ÏƒÎµ Î¿Î¹ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎ±Ï†ÎµÎ¯Ï‚, ÏƒÏ„Î¿Ï‡ÎµÏ…Î¼Î­Î½ÎµÏ‚ ÎºÎ±Î¹ Î±Ï€Î±Î»Î»Î±Î³Î¼Î­Î½ÎµÏ‚ Î±Ï€ÏŒ Ï€Î»ÎµÎ¿Î½Î±ÏƒÎ¼Î¿ÏÏ‚ Î® Î±ÏƒÎ±Ï†ÎµÎ¯Ï‚ Î´Î¹Î±Ï„Ï…Ï€ÏŽÏƒÎµÎ¹Ï‚.
- Î‘Î½Î¬Î´ÎµÎ¹Î¾Îµ Ï„Î± ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒÏ„ÎµÏÎ± Î¸Î­Î¼Î±Ï„Î± ÎºÎ±Î¹ Î¼Î·Î½ÏÎ¼Î±Ï„Î± Ï„Î¿Ï… ÎºÎµÎ¹Î¼Î­Î½Î¿Ï….
- ÎœÎ·Î½ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î²Î±ÏƒÎ¯Î¶Î¿Î½Ï„Î±Î¹ ÏƒÎµ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ­Ï‚ Î³Î½ÏŽÏƒÎµÎ¹Ï‚ Î® Î³ÎµÎ½Î¹ÎºÎ¬ ÏƒÏ…Î¼Ï€ÎµÏÎ¬ÏƒÎ¼Î±Ï„Î±.
-Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: ÎŸÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î»Î­Î¾ÎµÎ¹Ï‚ Î® Ï†ÏÎ¬ÏƒÎµÎ¹Ï‚ ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ Î±Î½Î¬Î¼ÎµÏƒÎ± ÏƒÎµ Î´Î¹Ï€Î»Î¿ÏÏ‚ Î±ÏƒÏ„ÎµÏÎ¯ÏƒÎºÎ¿Ï…Ï‚ (Ï€.Ï‡. **Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±**). Î‘Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ ÏƒÏ„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î¬ÏÎ¸ÏÎ¿ Î®Ï„Î±Î½ Î³ÏÎ±Î¼Î¼Î­Î½ÎµÏ‚ Î¼Îµ Î­Î½Ï„Î¿Î½Î· Î³ÏÎ±Ï†Î® (bold) ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ­Ï‚ Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Ï„Î±Î½ÏŒÎ·ÏƒÎ· Ï„Î¿Ï… Ï€ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï….:

{state["article_text"]}
"""
    res = config.llm.invoke([HumanMessage(content=prompt)])
    return {"questions": res.content}


def answer_questions(state: State) -> dict:
    prompt = f"""
Î•Î½ÎµÏÎ³ÎµÎ¯Ï‚ Ï‰Ï‚ ÎµÎ¹Î´Î¹ÎºÏŒÏ‚ ÏƒÏ„Î·Î½ ÎºÎ±Ï„Î±Î½ÏŒÎ·ÏƒÎ· ÎºÎ±Î¹ ÏƒÏÎ½Î¸ÎµÏƒÎ· Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏŽÎ½ Î±Ï€ÏŒ ÎºÎµÎ¯Î¼ÎµÎ½Î±. ÎŸ ÏÏŒÎ»Î¿Ï‚ ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ Î½Î± Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Î¼Îµ Î±ÎºÏÎ¯Î²ÎµÎ¹Î± ÏƒÏ„Î¹Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î±ÎºÎ¿Î»Î¿Ï…Î¸Î¿ÏÎ½, Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿Ï‚ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ ÏƒÏ„Î·Î½ Ï€Î±ÏÎµÏ‡ÏŒÎ¼ÎµÎ½Î· Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï….

ÎŸÎ´Î·Î³Î¯ÎµÏ‚:
- Î•ÏƒÏ„Î¯Î±ÏƒÎµ ÏƒÏ„Î± ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒÏ„ÎµÏÎ± ÏƒÎ·Î¼ÎµÎ¯Î± Ï„Î·Ï‚ Ï€ÎµÏÎ¯Î»Î·ÏˆÎ·Ï‚, Î´Î¯Î½Î¿Î½Ï„Î±Ï‚ Î­Î¼Ï†Î±ÏƒÎ· ÏƒÎµ ÎºÏÎ¯ÏƒÎ¹Î¼ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚.
- ÎŸÎ¹ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ ÏƒÎ¿Ï… Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏÎ½Ï„Î¿Î¼ÎµÏ‚, ÏƒÎ±Ï†ÎµÎ¯Ï‚ ÎºÎ±Î¹ Î±ÎºÏÎ¹Î²ÎµÎ¯Ï‚.
- Î‘Î½Î­Î´ÎµÎ¹Î¾Îµ Î±Î¯Ï„Î¹Î±, ÏƒÏ…Î½Î­Ï€ÎµÎ¹ÎµÏ‚ ÎºÎ±Î¹ Î»Î¿Î³Î¹ÎºÎ­Ï‚ ÏƒÏ‡Î­ÏƒÎµÎ¹Ï‚ ÏŒÏ€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÎµÎ¼Ï†Î±Î½ÎµÎ¯Ï‚.
- ÎœÎ·Î½ Ï€ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹Ï‚ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ­Ï‚ ÎµÎºÏ„Î¹Î¼Î®ÏƒÎµÎ¹Ï‚ Î® Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï€Î¿Ï… Î´ÎµÎ½ Î´Î·Î»ÏŽÎ½Î¿Î½Ï„Î±Î¹ ÏÎ·Ï„Î¬ ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¯Î»Î·ÏˆÎ·.

Î ÎµÏÎ¯Î»Î·ÏˆÎ·:
{state['summary']}

Î•ÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚:
{state['questions']}
"""
    res = config.llm.invoke([HumanMessage(content=prompt)])
    return {"answers": res.content}


def evaluate_answers(state: State) -> dict:
    prompt = f"""
Î•Î½ÎµÏÎ³ÎµÎ¯Ï‚ Ï‰Ï‚ Î±Î¾Î¹Î¿Î»Î¿Î³Î·Ï„Î®Ï‚ ÎºÎ±Ï„Î±Î½ÏŒÎ·ÏƒÎ·Ï‚ ÎºÎ±Î¹ ÏƒÏÎ½Î¿ÏˆÎ·Ï‚ ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…. ÎŸ ÏÏŒÎ»Î¿Ï‚ ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ Î½Î± Î±Î¾Î¹Î¿Î»Î¿Î³Î®ÏƒÎµÎ¹Ï‚ Ï„Î¹Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ ÎºÎ±Ï„Î±Î½ÏŒÎ·ÏƒÎ·Ï‚ ÏƒÎµ ÏƒÏ‡Î­ÏƒÎ· Î¼Îµ Ï„Î¿ Ï€Î»Î®ÏÎµÏ‚ Î¬ÏÎ¸ÏÎ¿ ÎºÎ±Î¹ Ï„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ® Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· (ÏƒÎµ bullets).

Î¤Î± ÏƒÏ‡ÏŒÎ»Î¹Î¬ ÏƒÎ¿Ï… Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î³Î¹Î± Ï„Î· Î²ÎµÎ»Ï„Î¯Ï‰ÏƒÎ· Ï„Î·Ï‚ Ï€ÎµÏÎ¯Î»Î·ÏˆÎ·Ï‚ ÏƒÎµ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î²Î®Î¼Î±.

ÎŸÎ´Î·Î³Î¯ÎµÏ‚:

1. Î•Î½Ï„ÏŒÏ€Î¹ÏƒÎµ ÎµÎ»Î»ÎµÎ¯ÏˆÎµÎ¹Ï‚:
   - Î ÏÎ¿ÏƒÎ´Î¹ÏŒÏÎ¹ÏƒÎµ Ï€Î¿Î¹ÎµÏ‚ Î²Î±ÏƒÎ¹ÎºÎ­Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î±Ï€ÏŒ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿ Î´ÎµÎ½ ÎºÎ±Î»ÏÏ€Ï„Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¯Î»Î·ÏˆÎ·, ÎºÎ±Î¹ ÎµÎ¾Î®Î³Î·ÏƒÎµ Î³Î¹Î±Ï„Î¯ Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÎ»Î»Î¹Ï€ÎµÎ¯Ï‚ Î® Î±ÏƒÎ±Ï†ÎµÎ¯Ï‚.

2. Î‘Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎµ Ï„Î·Î½ Ï€Î»Î·ÏÏŒÏ„Î·Ï„Î± Ï„Ï‰Î½ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÏ‰Î½:
   - ÎˆÎ»ÎµÎ³Î¾Îµ Î±Î½ Î¿Î¹ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Î½Ï„Î±Î½Î±ÎºÎ»Î¿ÏÎ½ Î¼Îµ Î±ÎºÏÎ¯Î²ÎµÎ¹Î± Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï… ÎºÎ±Î¹ ÎºÎ±Î»ÏÏ€Ï„Î¿Ï…Î½ Ï„Î± ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒÏ„ÎµÏÎ± ÏƒÎ·Î¼ÎµÎ¯Î±.

3. Î”ÏŽÏƒÎµ ÏƒÎ±Ï†Î® ÎºÎ±Î¹ Ï‡ÏÎ®ÏƒÎ¹Î¼Î± ÏƒÏ‡ÏŒÎ»Î¹Î±:
   - Î Î±ÏÎ¬Î¸ÎµÏƒÎµ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Ï€ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚ Î²ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚ Ï„Î·Ï‚ Ï€ÎµÏÎ¯Î»Î·ÏˆÎ·Ï‚ ÏŽÏƒÏ„Îµ Î½Î± ÎºÎ±Î»ÏÏ€Ï„ÎµÎ¹ ÎºÎ±Î»ÏÏ„ÎµÏÎ± Ï„Î¹Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚. Î•ÏƒÏ„Î¯Î±ÏƒÎµ ÏƒÎµ Î³ÎµÎ³Î¿Î½ÏŒÏ„Î±, ÎµÏ€Î¹Ï‡ÎµÎ¹ÏÎ®Î¼Î±Ï„Î±, Î±Î¹Ï„Î¯ÎµÏ‚ ÎºÎ±Î¹ ÏƒÏ…Î½Î­Ï€ÎµÎ¹ÎµÏ‚.

4. Î‘ÎºÏÎ¯Î²ÎµÎ¹Î± ÎºÎ±Î¹ Î±Î»Î®Î¸ÎµÎ¹Î±:
   - ÎœÎ·Î½ ÎµÎ¹ÏƒÎ¬Î³ÎµÎ¹Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï€Î¿Ï… Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÏƒÏ„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î¬ÏÎ¸ÏÎ¿.
   - Î‘Ï€ÏŒÏ†Ï…Î³Îµ Î³ÎµÎ½Î¹ÎºÎ¿Î»Î¿Î³Î¯ÎµÏ‚ ÎºÎ±Î¹ Î±ÏŒÏÎ¹ÏƒÏ„ÎµÏ‚ ÎµÎºÏ†ÏÎ¬ÏƒÎµÎ¹Ï‚.

Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·:
ÎŸÎ¹ Î»Î­Î¾ÎµÎ¹Ï‚ Î® Ï†ÏÎ¬ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ Î±Î½Î¬Î¼ÎµÏƒÎ± ÏƒÎµ Î´Î¹Ï€Î»Î¿ÏÏ‚ Î±ÏƒÏ„ÎµÏÎ¯ÏƒÎºÎ¿Ï…Ï‚ (Ï€.Ï‡. **Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±**) Ï€ÏÎ¿Î­ÏÏ‡Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Î­Î½Ï„Î¿Î½Î· Î³ÏÎ±Ï†Î® ÏƒÏ„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î¬ÏÎ¸ÏÎ¿. ÎœÏ€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ­Ï‚ ÎºÎ±Î¹ Î½Î± Ï…Ï€Î¿Î´Î·Î»ÏŽÎ½Î¿Ï…Î½ Î²Î±ÏƒÎ¹ÎºÎ¬ ÏƒÎ·Î¼ÎµÎ¯Î±.

Î Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±:

Î†ÏÎ¸ÏÎ¿:
{state["article_text"]}

Î ÎµÏÎ¯Î»Î·ÏˆÎ·:
{state['summary']}

Î•ÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚:
{state['questions']}

Î‘Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚:
{state['answers']}
"""
    res = config.llm.invoke([HumanMessage(content=prompt)])
    evaluation_text = res.content
    success_phrases = ["Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï€ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î±", "ÏŒÎ»Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏ‰ÏƒÏ„Î¬", "Î· Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· ÎµÎ¯Î½Î±Î¹ ÎµÏ€Î±ÏÎºÎ®Ï‚"]
    should_continue = not any(p in evaluation_text.lower() for p in success_phrases)
    #print("evaluation_count ", state.get("iteration_count", 0))
    #print("evaluation_complete", not should_continue)
    #print(evaluation_text)
    
    return {
        "feedback": evaluation_text,
        "evaluation_complete": not should_continue,
        "iteration_count": state.get("iteration_count", 0) + 1
    }


def improve_summary(state: State) -> dict:
    prompt = f"""
Î‘Î½Î±Î»Î±Î¼Î²Î¬Î½ÎµÎ¹Ï‚ Ï„Î¿Î½ ÏÏŒÎ»Î¿ Ï„Î¿Ï… ÎµÏ€Î¹Î¼ÎµÎ»Î·Ï„Î® Ï€ÎµÏÎ¹Î»Î®ÏˆÎµÏ‰Î½. ÎŸ ÏƒÏ„ÏŒÏ‡Î¿Ï‚ ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ Î½Î± Î²ÎµÎ»Ï„Î¹ÏŽÏƒÎµÎ¹Ï‚ Î¼Î¹Î± Î±ÏÏ‡Î¹ÎºÎ® Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· Î¬ÏÎ¸ÏÎ¿Ï… (ÏƒÎµ bullets), Î±Î¾Î¹Î¿Ï€Î¿Î¹ÏŽÎ½Ï„Î±Ï‚ Ï„Î± ÏƒÏ‡ÏŒÎ»Î¹Î± Î±Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚ ÎºÎ±Î¹ Ï„Î¿ Ï€Î»Î®ÏÎµÏ‚ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï….

### Î£ÎºÎ¿Ï€ÏŒÏ‚:
Î”Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ Î¼Î¹Î± Ï„ÎµÎ»Î¹ÎºÎ® Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· Ï€Î¿Ï… Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î¿Ï€Ï„Î¹ÎºÎ®, Î±ÎºÏÎ¹Î²Î®Ï‚ ÎºÎ±Î¹ Ï€Î»Î®ÏÏ‰Ï‚ ÎµÏ…Î¸Ï…Î³ÏÎ±Î¼Î¼Î¹ÏƒÎ¼Î­Î½Î· Î¼Îµ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï….

### ÎŸÎ´Î·Î³Î¯ÎµÏ‚:

- Î•Î½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎµ Î® Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎµ bullets ÏŽÏƒÏ„Îµ Î½Î± ÎºÎ±Î»ÏÏ€Ï„Î¿Ï…Î½ ÏŒÎ»Î± Ï„Î± Î¿Ï…ÏƒÎ¹ÏŽÎ´Î· ÏƒÎ·Î¼ÎµÎ¯Î± Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï….
- ÎšÏÎ¬Ï„Î·ÏƒÎµ Ï„Î· Î´Î¹Î±Ï„ÏÏ€Ï‰ÏƒÎ· Ï„Ï‰Î½ ÎºÎ±Î»Î¬ Î´Î¹Î±Ï„Ï…Ï€Ï‰Î¼Î­Î½Ï‰Î½ bullets Ï‰Ï‚ Î­Ï‡ÎµÎ¹, ÎµÏ†ÏŒÏƒÎ¿Î½ ÎµÎ¯Î½Î±Î¹ ÏƒÎ±Ï†Î®Ï‚ ÎºÎ±Î¹ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î·.
- Î”Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ Î­Ï‰Ï‚ 4 bullets, Î¼Îµ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏŒ Î¼Î®ÎºÎ¿Ï‚ 50â€“100 Î»Î­Î¾ÎµÎ¹Ï‚.
- ÎšÎ¬Î¸Îµ bullet Î½Î± Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÎ¹ Î¾ÎµÎºÎ¬Î¸Î±ÏÎ± Î­Î½Î± Î²Î±ÏƒÎ¹ÎºÏŒ Î³ÎµÎ³Î¿Î½ÏŒÏ‚, ÎµÏ€Î¹Ï‡ÎµÎ¯ÏÎ·Î¼Î± Î® ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï….
- Î‘Ï€ÏŒÏ†Ï…Î³Îµ Î³ÎµÎ½Î¹ÎºÏŒÏ„Î·Ï„ÎµÏ‚ ÎºÎ±Î¹ Î±ÏƒÎ±Ï†ÎµÎ¯Ï‚ Î´Î¹Î±Ï„Ï…Ï€ÏŽÏƒÎµÎ¹Ï‚.
- ÎœÎ·Î½ Î¾ÎµÎºÎ¹Î½Î¬Ï‚ bullets Î¼Îµ Î¬ÏÎ¸ÏÎ± (Ï€.Ï‡. "Î—", "Î¤Î¿"). Î ÏÎ¿Ï„Î¯Î¼Î·ÏƒÎµ ÎµÎ½ÎµÏÎ³Î·Ï„Î¹ÎºÎ® ÎºÎ±Î¹ Î¬Î¼ÎµÏƒÎ· ÏƒÏÎ½Ï„Î±Î¾Î·.
- Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎµ Ï„Î¿ ÏÏ†Î¿Ï‚ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï… (Î¿Ï…Î´Î­Ï„ÎµÏÎ¿, ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ Îº.Î»Ï€.).
- ÎœÎ·Î½ ÎµÎ¹ÏƒÎ¬Î³ÎµÎ¹Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï€Î¿Ï… Î´ÎµÎ½ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Î½Ï„Î±Î¹ ÏÎ·Ï„Î¬ ÏƒÏ„Î¿ Î¬ÏÎ¸ÏÎ¿.

### Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·:
Î¦ÏÎ¬ÏƒÎµÎ¹Ï‚ Î¼Î­ÏƒÎ± ÏƒÎµ Î´Î¹Ï€Î»Î¿ÏÏ‚ Î±ÏƒÏ„ÎµÏÎ¯ÏƒÎºÎ¿Ï…Ï‚ (Ï€.Ï‡. **Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±**) Ï€ÏÎ¿Î­ÏÏ‡Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Î­Î½Ï„Î¿Î½Î· Î³ÏÎ±Ï†Î® ÏƒÏ„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î¬ÏÎ¸ÏÎ¿. Î¥Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎ¿Ï…Î½ Ï€Î¹Î¸Î±Î½Î® ÏƒÎ·Î¼Î±ÏƒÎ¯Î± ÎºÎ±Î¹ Î±Î¾Î¯Î¶ÎµÎ¹ Î½Î± Ï„Î¹Ï‚ Î»Î¬Î²ÎµÎ¹Ï‚ Ï…Ï€ÏŒÏˆÎ·.:

Î‘ÏÎ¸ÏÎ¿:
{state['article_text']}

Î ÎµÏÎ¯Î»Î·ÏˆÎ·:
{state['summary']}

Î£Ï‡ÏŒÎ»Î¹Î±:
{state['feedback']}
"""
    res = config.llm.invoke([HumanMessage(content=prompt)])
    #print(res.content)
    return {"summary": res.content,
    "summary_7": res.content}



def compare_summaries(state: State) -> dict:
    prompt = f"""

Î•Î½ÎµÏÎ³ÎµÎ¯Ï‚ Ï‰Ï‚ ÎµÎ¹Î´Î¹ÎºÏŒÏ‚ ÏƒÏ„Î· ÏƒÏÎ½Î¿ÏˆÎ· ÎºÎ±Î¹ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏŽÎ½. ÎŸ ÏÏŒÎ»Î¿Ï‚ ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ Î½Î± ÏƒÏ…Î½Î¸Î­ÏƒÎµÎ¹Ï‚ Ï„Î·Î½ Ï„ÎµÎ»Î¹ÎºÎ®, ÏƒÏ…Î¼Ï€Ï…ÎºÎ½Ï‰Î¼Î­Î½Î· Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· ÎµÎ½ÏŒÏ‚ ÎµÎ»Î»Î·Î½Î¹ÎºÎ¿Ï Î¬ÏÎ¸ÏÎ¿Ï… ÏƒÎµ Î¼Î¿ÏÏ†Î® bullets, Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿Ï‚ ÏƒÏ„Î± Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± Ï„Ï‰Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏŽÎ½ `generate_summary` ÎºÎ±Î¹ `improve_summary`.

Î£Ï„ÏŒÏ‡Î¿Ï‚: ÎÎ± ÏƒÏ…Î³Ï‡Ï‰Î½ÎµÏÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ Î½Î± ÎµÎ¾Î¹ÏƒÎ¿ÏÏÎ¿Ï€Î®ÏƒÎµÎ¹Ï‚ Ï„Î¹Ï‚ Î´ÏÎ¿ Ï€ÎµÏÎ¹Î»Î®ÏˆÎµÎ¹Ï‚, ÏŽÏƒÏ„Îµ Î½Î± Ï€ÏÎ¿ÎºÏÏˆÎµÎ¹ Î· Ï€Î¹Î¿ ÏƒÎ±Ï†Î®Ï‚, Ï€Î»Î®ÏÎ·Ï‚ ÎºÎ±Î¹ Î¿Ï…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÎ® Î±Ï€Î¿Ï„ÏÏ€Ï‰ÏƒÎ· Ï„Ï‰Î½ Î²Î±ÏƒÎ¹ÎºÏŽÎ½ ÏƒÎ·Î¼ÎµÎ¯Ï‰Î½ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï….

### ÎŸÎ´Î·Î³Î¯ÎµÏ‚:
- Î”Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ Î­Ï‰Ï‚ **3 bullets**, ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¿Ï Î¼Î®ÎºÎ¿Ï…Ï‚ **50â€“200 Î»Î­Î¾ÎµÏ‰Î½**.
- ÎšÎ¬Î¸Îµ bullet Î½Î± Î¼ÎµÏ„Î±Ï†Î­ÏÎµÎ¹ **Î¼Î¯Î± Î²Î±ÏƒÎ¹ÎºÎ® Î¹Î´Î­Î±, ÎµÏ€Î¹Ï‡ÎµÎ¯ÏÎ·Î¼Î± Î® Î³ÎµÎ³Î¿Î½ÏŒÏ‚** Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï….
- **Î£Ï…Î½Î´ÏÎ±ÏƒÎµ**, **Î±Ï†Î±Î¯ÏÎµÏƒÎµ ÎµÏ€Î±Î½Î±Î»Î®ÏˆÎµÎ¹Ï‚**, ÎºÎ±Î¹ **Î±Î½Î±Î´Î¹Î±Ï„ÏÏ€Ï‰ÏƒÎµ** ÏŒÏ€Î¿Ï… Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î³Î¹Î± Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ· ÎºÎ±Î¸Î±ÏÏŒÏ„Î·Ï„Î± ÎºÎ±Î¹ ÏƒÏ…Î¼Ï€ÏÎºÎ½Ï‰ÏƒÎ·.
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ **Î¿Ï…Î´Î­Ï„ÎµÏÎ¿ Î® ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ ÏÏ†Î¿Ï‚**, **ÏƒÎ±Ï†Î® ÏƒÏÎ½Ï„Î±Î¾Î·** ÎºÎ±Î¹ **Î¬Î¼ÎµÏƒÎ· Î³Î»ÏŽÏƒÏƒÎ±**.
- Î‘Ï€ÏŒÏ†Ï…Î³Îµ **Î³ÎµÎ½Î¹ÎºÏŒÏ„Î·Ï„ÎµÏ‚**, **Ï€Î»ÎµÎ¿Î½Î±ÏƒÎ¼Î¿ÏÏ‚** Î® **Î¼Î· Ï„ÎµÎºÎ¼Î·ÏÎ¹Ï‰Î¼Î­Î½ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚**.
- Î— Ï„ÎµÎ»Î¹ÎºÎ® Î¼Î¿ÏÏ†Î® Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ **Î­Ï„Î¿Î¹Î¼Î· Î³Î¹Î± Î´Î·Î¼Î¿ÏƒÎ¯ÎµÏ…ÏƒÎ·**, Ï…ÏˆÎ·Î»Î®Ï‚ Ï€Î¿Î¹ÏŒÏ„Î·Ï„Î±Ï‚ ÎºÎ±Î¹ Î½Î± Î±Ï€Î¿Ï„Ï…Ï€ÏŽÎ½ÎµÎ¹ Î¼Îµ Î±ÎºÏÎ¯Î²ÎµÎ¹Î± Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î¿Ï… Î±ÏÏ‡Î¹ÎºÎ¿Ï Î¬ÏÎ¸ÏÎ¿Ï….

ÎœÎ·Î½ Ï€ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹Ï‚ Î½Î­Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±. Î•ÏƒÏ„Î¯Î±ÏƒÎµ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ ÏƒÎµ ÏŒÏƒÎ± Ï€ÏÎ¿ÎºÏÏ€Ï„Î¿Ï…Î½ Î±Ï€ÏŒ Ï„Î¹Ï‚ Î´ÏÎ¿ Ï€ÎµÏÎ¹Î»Î®ÏˆÎµÎ¹Ï‚.

Î†ÏÎ¸ÏÎ¿:
{state["article_text"]}

ðŸ“„ Î ÏÏŽÏ„Î· Î ÎµÏÎ¯Î»Î·ÏˆÎ· (Î±Ï€ÏŒ `generate_summary`):
{state["summary_1"]}

ðŸ“„ Î”ÎµÏÏ„ÎµÏÎ· Î ÎµÏÎ¯Î»Î·ÏˆÎ· (Î±Ï€ÏŒ `improve_summary`):
{state["summary_7"]}
"""

    res = config.llm.invoke([HumanMessage(content=prompt)])
    return {"summary": res.content}




#def save_to_file(state: State) -> dict:
    #print("evaluation_count save ", state.get("iteration_count", 0))
#    with open(state["output_path"], "w", encoding="utf-8") as f:
#        f.write(state["summary"])
#    return {"output_path": state["output_path"]}

def save_to_file(state: State) -> dict:
    output_dir = state["output_path"]  # This should now be a directory path (not a file)
    os.makedirs(output_dir, exist_ok=True)  # Ensure the directory exists

    summary_path = os.path.join(output_dir, "summary.txt")
    with open(summary_path, "w", encoding="utf-8") as f:
        f.write(state["summary"])

    if "explanations" in state:
        terms_path = os.path.join(output_dir, "terms.txt")
        with open(terms_path, "w", encoding="utf-8") as f:
            f.write(state["explanations"])
    else:
        terms_path = None

    return {"output_path": state["output_path"]}









